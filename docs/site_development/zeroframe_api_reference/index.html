<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ZeroFrame API 参考文档 - ZeroNet</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  

  <link rel="stylesheet" href="../../css/fonts.css" type="text/css" />

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../docs.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "ZeroFrame API 参考文档";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../docs.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> ZeroNet</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">介绍</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../faq/">FAQ 常见问题</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>开始使用ZeroNet</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using_zeronet/installing/">安装</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using_zeronet/sample_sites/">网站示例</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../using_zeronet/create_new_site/">创建新站点</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>站点开发</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting_started/">入门</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">ZeroFrame API 参考文档</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#zeroframe-api">ZeroFrame API 参考文档</a></li>
                
            
                <li class="toctree-l3"><a href="#wrapper">Wrapper</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperconfirm-message-button_caption">wrapperConfirm message, [button_caption]</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperinnerloaded">wrapperInnerLoaded</a></li>
                
                    <li><a class="toctree-l4" href="#wrappergetlocalstorage">wrapperGetLocalStorage</a></li>
                
                    <li><a class="toctree-l4" href="#wrappergetstate">wrapperGetState</a></li>
                
                    <li><a class="toctree-l4" href="#wrappernotification-type-message-timeout">wrapperNotification type, message, [timeout]</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperopenwindow-_url-target-specs">wrapperOpenWindow _url, [target], [specs]</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperpermissionadd-permission">wrapperPermissionAdd permission</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperprompt-message-type">wrapperPrompt message, [type]</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperpushstate-state-title-url">wrapperPushState state, title, url</a></li>
                
                    <li><a class="toctree-l4" href="#wrapperreplacestate-state-title-url">wrapperReplaceState state, title, url</a></li>
                
                    <li><a class="toctree-l4" href="#wrappersetlocalstorage-data">wrapperSetLocalStorage data</a></li>
                
                    <li><a class="toctree-l4" href="#wrappersettitle-title">wrapperSetTitle title</a></li>
                
                    <li><a class="toctree-l4" href="#wrappersetviewport-viewport">wrapperSetViewport viewport</a></li>
                
            
                <li class="toctree-l3"><a href="#uiserver">UiServer</a></li>
                
                    <li><a class="toctree-l4" href="#certadd-domain-auth_type-auth_user_name-cert">certAdd domain, auth_type, auth_user_name, cert</a></li>
                
                    <li><a class="toctree-l4" href="#certselect-accepted_domains">certSelect accepted_domains</a></li>
                
                    <li><a class="toctree-l4" href="#channeljoin-channel">channelJoin channel</a></li>
                
                    <li><a class="toctree-l4" href="#dbquery-query">dbQuery query</a></li>
                
                    <li><a class="toctree-l4" href="#filedelete-inner_path">fileDelete inner_path</a></li>
                
                    <li><a class="toctree-l4" href="#fileget-inner_path-required-format-timeout">fileGet inner_path, [required], [format], [timeout]</a></li>
                
                    <li><a class="toctree-l4" href="#filelist-inner_path">fileList inner_path</a></li>
                
                    <li><a class="toctree-l4" href="#filequery-dir_inner_path-query">fileQuery dir_inner_path, query</a></li>
                
                    <li><a class="toctree-l4" href="#filerules-inner_path">fileRules inner_path</a></li>
                
                    <li><a class="toctree-l4" href="#filewrite-inner_path-content">fileWrite inner_path, content</a></li>
                
                    <li><a class="toctree-l4" href="#serverinfo">serverInfo</a></li>
                
                    <li><a class="toctree-l4" href="#siteinfo">siteInfo</a></li>
                
                    <li><a class="toctree-l4" href="#sitepublish-privatekey-inner_path-sign">sitePublish [privatekey], [inner_path], [sign]</a></li>
                
                    <li><a class="toctree-l4" href="#sitesign-privatekey-inner_path">siteSign [privatekey], [inner_path]</a></li>
                
                    <li><a class="toctree-l4" href="#siteupdate-address">siteUpdate address</a></li>
                
            
                <li class="toctree-l3"><a href="#plugin-cryptmessage">Plugin: CryptMessage</a></li>
                
                    <li><a class="toctree-l4" href="#userpublickey-index">userPublickey [index]</a></li>
                
                    <li><a class="toctree-l4" href="#eciesencrypt-text-publickey-return_aes_key">eciesEncrypt text, [publickey], [return_aes_key]</a></li>
                
                    <li><a class="toctree-l4" href="#eciesdecrypt-params-privatekey">eciesDecrypt params, [privatekey]</a></li>
                
                    <li><a class="toctree-l4" href="#aesencrypt-text-key-iv">aesEncrypt text, [key], [iv]</a></li>
                
                    <li><a class="toctree-l4" href="#aesdecrypt-iv-encrypted_text-key">aesDecrypt iv, encrypted_text, key</a></li>
                
                    <li><a class="toctree-l4" href="#aesdecrypt-encrypted_texts-keys">aesDecrypt encrypted_texts, keys</a></li>
                
            
                <li class="toctree-l3"><a href="#_1">插件：消息流</a></li>
                
                    <li><a class="toctree-l4" href="#feedfollow-feeds">feedFollow feeds</a></li>
                
                    <li><a class="toctree-l4" href="#feedlistfollow">feedListFollow</a></li>
                
                    <li><a class="toctree-l4" href="#feedquery-limit-day_limit">feedQuery [limit], [day_limit]</a></li>
                
            
                <li class="toctree-l3"><a href="#plugin-mergersite">Plugin: MergerSite</a></li>
                
                    <li><a class="toctree-l4" href="#mergersiteadd-addresses">mergerSiteAdd addresses</a></li>
                
                    <li><a class="toctree-l4" href="#mergersitedelete-address">mergerSiteDelete address</a></li>
                
                    <li><a class="toctree-l4" href="#mergersitelist-query_site_info">mergerSiteList [query_site_info]</a></li>
                
            
                <li class="toctree-l3"><a href="#plugin-mute">Plugin: Mute</a></li>
                
                    <li><a class="toctree-l4" href="#muteadd-auth_address-cert_user_id-reason">muteAdd auth_address, cert_user_id, reason</a></li>
                
                    <li><a class="toctree-l4" href="#muteremove-auth_address">muteRemove auth_address</a></li>
                
                    <li><a class="toctree-l4" href="#mutelist">muteList</a></li>
                
            
                <li class="toctree-l3"><a href="#plugin-optionalmanager">Plugin: OptionalManager</a></li>
                
                    <li><a class="toctree-l4" href="#optionalfilelist-address-orderby-limit">optionalFileList [address], [orderby], [limit]</a></li>
                
                    <li><a class="toctree-l4" href="#optionalfileinfo-inner_path">optionalFileInfo inner_path</a></li>
                
                    <li><a class="toctree-l4" href="#optionalfilepin-inner_path-address">optionalFilePin inner_path, [address]</a></li>
                
                    <li><a class="toctree-l4" href="#optionalfileunpin-inner_path-address">optionalFileUnpin inner_path, [address]</a></li>
                
                    <li><a class="toctree-l4" href="#optionalfiledelete-inner_path-address">optionalFileDelete inner_path, [address]</a></li>
                
                    <li><a class="toctree-l4" href="#optionallimitstats">optionalLimitStats</a></li>
                
                    <li><a class="toctree-l4" href="#actionoptionallimitset-limit">actionOptionalLimitSet limit</a></li>
                
                    <li><a class="toctree-l4" href="#actionoptionalhelplist-address">actionOptionalHelpList [address]</a></li>
                
                    <li><a class="toctree-l4" href="#actionoptionalhelp-directory-title-address">actionOptionalHelp directory, title, [address]</a></li>
                
                    <li><a class="toctree-l4" href="#actionoptionalhelpremove-directory-address">actionOptionalHelpRemove directory, [address]</a></li>
                
                    <li><a class="toctree-l4" href="#actionoptionalhelpall-value-address">actionOptionalHelpAll value, [address]</a></li>
                
            
                <li class="toctree-l3"><a href="#admin-commands">Admin commands</a></li>
                
                    <li><a class="toctree-l4" href="#configset-key-value">configSet key, value</a></li>
                
                    <li><a class="toctree-l4" href="#certset-domain">certSet domain</a></li>
                
                    <li><a class="toctree-l4" href="#channeljoinallsite-channel">channelJoinAllsite channel</a></li>
                
                    <li><a class="toctree-l4" href="#serverportcheck">serverPortcheck</a></li>
                
                    <li><a class="toctree-l4" href="#servershutdown">serverShutdown</a></li>
                
                    <li><a class="toctree-l4" href="#serverupdate">serverUpdate</a></li>
                
                    <li><a class="toctree-l4" href="#siteclone-address-root_inner_path">siteClone address, [root_inner_path]</a></li>
                
                    <li><a class="toctree-l4" href="#sitelist">siteList</a></li>
                
                    <li><a class="toctree-l4" href="#sitepause-address">sitePause address</a></li>
                
                    <li><a class="toctree-l4" href="#siteresume-address">siteResume address</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../content_json/">content.json的结构</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../dbschema_json/">dbschema.json的结构</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cert_authority/">授权认证</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>帮助ZeroNet的开发</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../help_zeronet/contributing/">向 ZeroNet捐助</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../help_zeronet/network_protocol/">网络协议</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../help_zeronet/donate/">捐助</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">ZeroNet</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>站点开发 &raquo;</li>
        
      
    
    <li>ZeroFrame API 参考文档</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/stgapr/zeronet-Documentation-ZH_CN" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="zeroframe-api">ZeroFrame API 参考文档</h1>
<h1 id="wrapper">Wrapper</h1>
<p><em>These commands handled by wrapper frame and does not sent to UiServer using websocket</em></p>
<h4 id="wrapperconfirm-message-button_caption">wrapperConfirm <em>message, [button_caption]</em></h4>
<p>按下确认键的时跳出提示消息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>message</strong></td>
<td>想要提示的消息</td>
</tr>
<tr>
<td><strong>button_caption</strong> (可选)</td>
<td>确认键的显示文本 (默认为 OK)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如点击了按钮，返回True</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 删除站点
siteDelete: (address) -&gt;
    site = @sites[address]
    title = site.content.title
    if title.length &gt; 40
        title = title.substring(0, 15)+&quot;...&quot;+title.substring(title.length-10)
    @cmd &quot;wrapperConfirm&quot;, [&quot;Are you sure you sure? &lt;b&gt;#{title}&lt;/b&gt;&quot;, &quot;Delete&quot;], (confirmed) =&gt;
        @log &quot;Deleting #{site.address}...&quot;, confirmed
        if confirmed
            $(&quot;.site-#{site.address}&quot;).addClass(&quot;deleted&quot;)
            @cmd &quot;siteDelete&quot;, {&quot;address&quot;: address}
</code></pre>

<hr />
<h4 id="wrapperinnerloaded">wrapperInnerLoaded</h4>
<p>适用于页面URL的 windows.location.hash 。 当页面已经加载完成，要跳转到特定定位点时，该事件被触发。</p>
<hr />
<h4 id="wrappergetlocalstorage">wrapperGetLocalStorage</h4>
<p><strong>返回</strong>: 浏览器对本页面的本地存储内容</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;wrapperGetLocalStorage&quot;, [], (res) =&gt;
    res ?= {}
    @log &quot;本地存储值:&quot;, res
</code></pre>

<hr />
<h4 id="wrappergetstate">wrapperGetState</h4>
<p><strong>返回值</strong>: 浏览器的当前历史的状态对象</p>
<hr />
<h4 id="wrappernotification-type-message-timeout">wrapperNotification <em>type, message, [timeout]</em></h4>
<p>显示一条消息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>type</strong></td>
<td>可能的值: info, error, done</td>
</tr>
<tr>
<td><strong>message</strong></td>
<td>你想要弹出的消息</td>
</tr>
<tr>
<td><strong>timeout</strong> （可选）</td>
<td>在多少秒后自动隐藏消息（可选的）（以毫秒计）</td>
</tr>
</tbody>
</table>
<p><strong>返回值：</strong>: None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;wrapperNotification&quot;, [&quot;done&quot;, &quot;Your registration has been sent!&quot;, 10000]
</code></pre>

<hr />
<h4 id="wrapperopenwindow-_url-target-specs">wrapperOpenWindow _url, [target], [specs]</h4>
<p>跳转，或者打开新弹出窗口</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>url</strong></td>
<td>已打开页面的URL</td>
</tr>
<tr>
<td><strong>target</strong> (可选)</td>
<td>目标窗口名称</td>
</tr>
<tr>
<td><strong>specs</strong> (可选)</td>
<td>打开的窗口的特定属性 (参见<a href="http://www.w3schools.com/jsref/met_win_open.asp">window.open specs</a>)</td>
</tr>
</tbody>
</table>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;wrapperOpenWindow&quot;, [&quot;https://zeronet.io&quot;, &quot;_blank&quot;, &quot;width=550,height=600,location=no,menubar=no&quot;]
</code></pre>

<hr />
<h4 id="wrapperpermissionadd-permission">wrapperPermissionAdd <em>permission</em></h4>
<p>为网站请求新的授权</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>permission</strong></td>
<td>授权名 (eg. Merger:ZeroMe)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="wrapperprompt-message-type">wrapperPrompt <em>message, [type]</em></h4>
<p>用户输入时的提示文本</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>message</strong></td>
<td>想显示的消息</td>
</tr>
<tr>
<td><strong>type</strong> （可选）</td>
<td>输入类型 (默认： text)</td>
</tr>
</tbody>
</table>
<p><strong>返回值：</strong>: 输入的文本</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 提示输入密钥
@cmd &quot;wrapperPrompt&quot;, [&quot;输入你的密钥：&quot;, &quot;password&quot;], (privatekey) =&gt;
    $(&quot;.publishbar .button&quot;).addClass(&quot;loading&quot;)
    # 签署 content.json，然后并且把请求发送给服务器
    @cmd &quot;sitePublish&quot;, [privatekey], (res) =&gt;
        $(&quot;.publishbar .button&quot;).removeClass(&quot;loading&quot;)
        @log &quot;发送结果：&quot;, res
</code></pre>

<hr />
<h4 id="wrapperpushstate-state-title-url">wrapperPushState <em>state, title, url</em></h4>
<p>改变URL，并且在浏览器历史记录中添加新的一行。 参加: <a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API#The_pushState()_method">pushState JS 方法</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>state</strong></td>
<td>状态的js对象</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>页面标题</td>
</tr>
<tr>
<td><strong>url</strong></td>
<td>页面URL</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<pre><code class="coffeescript">@cmd &quot;wrapperPushState&quot;, [{&quot;scrollY&quot;: 100}, &quot;Profile page&quot;, &quot;Profile&quot;]
</code></pre>

<hr />
<h4 id="wrapperreplacestate-state-title-url">wrapperReplaceState <em>state, title, url</em></h4>
<p>改变URL，然而不在浏览器历史记录中添加新的一行。 参见: <a href="https://developer.mozilla.org/en-US/docs/Web/API/History_API#The_replaceState()_method">replaceState JS 方法</a></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>state</strong></td>
<td>状态的js对象</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>页面标题</td>
</tr>
<tr>
<td><strong>url</strong></td>
<td>页面URL</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<pre><code class="coffeescript">@cmd &quot;wrapperReplaceState&quot;, [{&quot;scrollY&quot;: 100}, &quot;Profile page&quot;, &quot;Profile&quot;]
</code></pre>

<hr />
<h4 id="wrappersetlocalstorage-data">wrapperSetLocalStorage <em>data</em></h4>
<p>为该网站设置浏览器的本地存储数据</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>data</strong></td>
<td>你想要保存的任何数据结构</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">Page.local_storage[&quot;topic.#{@topic_id}_#{@topic_user_id}.visited&quot;] = Time.timestamp()
Page.cmd &quot;wrapperSetLocalStorage&quot;, Page.local_storage
</code></pre>

<hr />
<h4 id="wrappersettitle-title">wrapperSetTitle <em>title</em></h4>
<p>设置浏览器标题</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>title</strong></td>
<td>新的浏览器窗口/标签页标题</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">Page.cmd &quot;wrapperSetTitle&quot;, &quot;newtitle&quot;
</code></pre>

<hr />
<h4 id="wrappersetviewport-viewport">wrapperSetViewport <em>viewport</em></h4>
<p>设置viewport 元标签的内容 (在适配移动版网页时有用)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>viewport</strong></td>
<td>viewport元标签内容</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 提示输入私钥
@cmd &quot;wrapperSetViewport&quot;, &quot;width=device-width, initial-scale=1.0&quot;
</code></pre>

<hr />
<h1 id="uiserver">UiServer</h1>
<p>UiServer 对于ZeroNet的意义，和LAMP（Linux Apache mySQL和PHP）对普通网站的意义差不多。</p>
<p>UiServer 实现了所有后端处理工作 (例如在数据库中查询，处理文件等），这些API让你能创建动态网站。</p>
<h4 id="certadd-domain-auth_type-auth_user_name-cert">certAdd <em>domain, auth_type, auth_user_name, cert</em></h4>
<p>为当前用户添加新的认证</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>domain</strong></td>
<td>Certificate issuer domain</td>
</tr>
<tr>
<td><strong>auth_type</strong></td>
<td>注册时的认证类型</td>
</tr>
<tr>
<td><strong>auth_user_name</strong></td>
<td>注册时的用户名</td>
</tr>
<tr>
<td><strong>cert</strong></td>
<td>证书主体，即为授权站点方签署的 <code>auth_address#auth_type/auth_user_name</code></td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: "ok", "Not changed" 或 {"error": error_message}</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;certAdd&quot;, [&quot;zeroid.bit&quot;, auth_type, user_name, cert_sign], (res) =&gt;
    $(&quot;.ui&quot;).removeClass(&quot;flipped&quot;)
    if res.error
        @cmd &quot;wrapperNotification&quot;, [&quot;error&quot;, &quot;#{res.error}&quot;]
</code></pre>

<hr />
<h4 id="certselect-accepted_domains">certSelect <em>accepted_domains</em></h4>
<p>显示认证选择器</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>accepted_domains</strong></td>
<td>List of domains that accepted by site as authorization provider</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;certSelect&quot;, {&quot;accepted_domains&quot;: [&quot;zeroid.bit&quot;]}
</code></pre>

<hr />
<h4 id="channeljoin-channel">channelJoin <em>channel</em></h4>
<p>请求一个站点事件的通知消息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>channel</strong></td>
<td>要加入的频道</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<p><strong>Channels</strong>:</p>
<ul>
<li><strong>siteChanged</strong> (joined by default)<br>Events: peers_added, file_started, file_done, file_failed</li>
</ul>
<p><strong>举例</strong>   </p>
<pre><code class="coffeescript"># Wrapper websocket connection ready
onOpenWebsocket: (e) =&gt;
    @cmd &quot;channelJoinAllsite&quot;, {&quot;channel&quot;: &quot;siteChanged&quot;}

# Route incoming requests and messages
route: (cmd, data) -&gt;
    if cmd == &quot;setSiteInfo&quot;
        @log &quot;Site changed&quot;, data
    else
        @log &quot;Unknown command&quot;, cmd, data
</code></pre>

<p><strong>事件数据(event data)示例</strong></p>
<pre><code class="json">{
    &quot;tasks&quot;:0,
    &quot;size_limit&quot;:10,
    &quot;address&quot;:&quot;1RivERqttrjFqwp9YH1FviduBosQPtdBN&quot;,
    &quot;next_size_limit&quot;:10,
    &quot;event&quot;:[ &quot;file_done&quot;, &quot;index.html&quot; ],
    [...] # Same as siteInfo return dict
}

</code></pre>

<hr />
<h4 id="dbquery-query">dbQuery <em>query</em></h4>
<p>在SQL缓存上运行一个查询语句</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>query</strong></td>
<td>SQL语句</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: <list> 查询结果</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@log &quot;更新用户信息...&quot;, @my_address
Page.cmd &quot;dbQuery&quot;, [&quot;SELECT user.*, json.json_id AS data_json_id FROM user LEFT JOIN json USING(path) WHERE path='#{@my_address}/data.json'&quot;], (res) =&gt;
    if res.error or res.length == 0 # Db not ready yet or No user found
        $(&quot;.head-user.visitor&quot;).css(&quot;display&quot;, &quot;&quot;)
        $(&quot;.user_name-my&quot;).text(&quot;Visitor&quot;)
        if cb then cb()
        return

    @my_row = res[0]
    @my_id = @my_row[&quot;user_id&quot;]
    @my_name = @my_row[&quot;user_name&quot;]
    @my_max_size = @my_row[&quot;max_size&quot;]
</code></pre>

<hr />
<h4 id="filedelete-inner_path">fileDelete <em>inner_path</em></h4>
<p>删除一个文件</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>The file you want to delete</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如成功，返回"ok"；否则返回error message</p>
<hr />
<h4 id="fileget-inner_path-required-format-timeout">fileGet <em>inner_path, [required], [format], [timeout]</em></h4>
<p>获取文件内容</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>想获取的文件</td>
</tr>
<tr>
<td><strong>required</strong> （可选）</td>
<td>假如文件不存在，继续尝试，并且等待该文件 (默认: True)</td>
</tr>
<tr>
<td><strong>format</strong> （可选）</td>
<td>返回的文件的编码形式 (text 或 base64) （默认： text）</td>
</tr>
<tr>
<td><strong>timeout</strong> （可选）</td>
<td>超时时长 (默认： 300)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: <string> 文件内容</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 在ZeroTalk里赞一个话题
submitTopicVote: (e) =&gt;
    if not Users.my_name # Not registered
        Page.cmd &quot;wrapperNotification&quot;, [&quot;info&quot;, &quot;Please, request access before posting.&quot;]
        return false

    elem = $(e.currentTarget)
    elem.toggleClass(&quot;active&quot;).addClass(&quot;loading&quot;)
    inner_path = &quot;data/users/#{Users.my_address}/data.json&quot;

    Page.cmd &quot;fileGet&quot;, [inner_path], (data) =&gt;
        data = JSON.parse(data)
        data.topic_votes ?= {} # Create if not exits
        topic_address = elem.parents(&quot;.topic&quot;).data(&quot;topic_address&quot;)

        if elem.hasClass(&quot;active&quot;) # Add upvote to topic
            data.topic_votes[topic_address] = 1
        else # Remove upvote from topic
            delete data.topic_votes[topic_address]

        # Write file and publish to other peers
        Page.writePublish inner_path, Page.jsonEncode(data), (res) =&gt;
            elem.removeClass(&quot;loading&quot;)
            if res == true
                @log &quot;File written&quot;
            else # Failed
                elem.toggleClass(&quot;active&quot;) # Change back

    return false
</code></pre>

<hr />
<h4 id="filelist-inner_path">fileList <em>inner_path</em></h4>
<p>目录里的文件列表</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>想要列出文件列表的目录</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 目录里的文件列表 (递归的)</p>
<hr />
<h4 id="filequery-dir_inner_path-query">fileQuery <em>dir_inner_path, query</em></h4>
<p>Simple json file query command</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>dir_inner_path</strong></td>
<td>想要的文件的通配符</td>
</tr>
<tr>
<td><strong>query</strong></td>
<td>查询语句命令 （可选）</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: <list> 匹配的内容</p>
<p><strong>查询例子</strong></p>
<ul>
<li><code>["data/users/*/data.json", "topics"]</code>: Returns all topics node from all user files</li>
<li><code>["data/users/*/data.json", "comments.1@2"]</code>: Returns <code>user_data["comments"]["1@2"]</code> value from all user files</li>
<li><code>["data/users/*/data.json", ""]</code>: Returns all data from users files</li>
<li><code>["data/users/*/data.json"]</code>: Returns all data from users files (same as above)</li>
</ul>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;fileQuery&quot;, [&quot;data/users/*/data.json&quot;, &quot;topics&quot;], (topics) =&gt;
    topics.sort (a, b) -&gt; # Sort by date
        return a.added - b.added
    for topic in topics
        @log topic.topic_id, topic.inner_path, topic.title
</code></pre>

<hr />
<h4 id="filerules-inner_path">fileRules <em>inner_path</em></h4>
<p>返回文件的规则。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>文件路径</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: <list> 匹配的结果</p>
<p><strong>示例结果</strong></p>
<pre><code class="json">{
    &quot;current_size&quot;: 2485,
    &quot;cert_signers&quot;: {&quot;zeroid.bit&quot;: [&quot;1iD5ZQJMNXu43w1qLB8sfdHVKppVMduGz&quot;]},
    &quot;files_allowed&quot;: &quot;data.json&quot;,
    &quot;signers&quot;: [&quot;1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj&quot;],
    &quot;user_address&quot;: &quot;1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj&quot;,
    &quot;max_size&quot;: 100000
}
</code></pre>

<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;fileRules&quot;, &quot;data/users/1J3rJ8ecnwH2EPYa6MrgZttBNc61ACFiCj/content.json&quot;, (rules) =&gt;
    @log rules
</code></pre>

<hr />
<h4 id="filewrite-inner_path-content">fileWrite <em>inner_path, content</em></h4>
<p>写入文件内容</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>想写入的文件路径</td>
</tr>
<tr>
<td><strong>content_base64</strong></td>
<td>想写入的文件内容 (base64编码)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如写入成功，返回"ok"。否则返回 error message</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">writeData: (cb=null) -&gt;
    # json格式，utf8编码
    json_raw = unescape(encodeURIComponent(JSON.stringify({&quot;hello&quot;: &quot;ZeroNet&quot;}, undefined, '\t')))
    # 转换为base64并发送
    @cmd &quot;fileWrite&quot;, [&quot;data.json&quot;, btoa(json_raw)], (res) =&gt;
        if res == &quot;ok&quot;
            if cb then cb(true)
        else
            @cmd &quot;wrapperNotification&quot;, [&quot;error&quot;, &quot;File write error: #{res}&quot;]
            if cb then cb(false)
</code></pre>

<p><em>提示：</em>  假如想要写入那些不在content.json里列出的文件，你必须在  <code>data/sites.json</code>中在想操作的站点那一块写入一行<code>"own": true</code></p>
<hr />
<h4 id="serverinfo">serverInfo</h4>
<p><strong>Return:</strong> <dict> 服务端的所有消息</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;serverInfo&quot;, {}, (server_info) =&gt;
    @log &quot;服务端信息:&quot;, server_info
</code></pre>

<p><strong>示例返回值</strong></p>
<pre><code class="json">{
    &quot;debug&quot;: true, # 调试模式
    &quot;fileserver_ip&quot;: &quot;*&quot;, # 绑定的文件服务IP
    &quot;fileserver_port&quot;: 15441, # 绑定的文件服务端口
    &quot;ip_external&quot;: true, # 启用被动模式
    &quot;platform&quot;: &quot;win32&quot;, # OS
    &quot;ui_ip&quot;: &quot;127.0.0.1&quot;, # 绑定的UiServer 
    &quot;ui_port&quot;: 43110, # UiServer端口 (web)
    &quot;version&quot;: &quot;0.2.5&quot; # ZeroNet版本号
}
</code></pre>

<hr />
<h4 id="siteinfo">siteInfo</h4>
<p><strong>返回值</strong>: <dict> 本站点的所有信息</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">@cmd &quot;siteInfo&quot;, {}, (site_info) =&gt;
    @log &quot;Site info:&quot;, site_info
</code></pre>

<p><strong>示例返回值</strong></p>
<pre><code class="json">{
    &quot;tasks&quot;: 0, # 目前正在下载的文件数
    &quot;size_limit&quot;: 10, # 该站点的磁盘大小限额
    &quot;address&quot;: &quot;1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr&quot;, # 站点地址
    &quot;next_size_limit&quot;: 10, # 站点文件数限额（？）
    &quot;auth_address&quot;: &quot;2D6xXUmCVAXGrbVUGRRJdS4j1hif1EMfae&quot;, # 当前用户的比特币地址
    &quot;auth_key_sha512&quot;: &quot;269a0f4c1e0c697b9d56ccffd9a9748098e51acc5d2807adc15a587779be13cf&quot;, # （该字段已经废弃，请勿使用）
    &quot;peers&quot;: 14, # 连接到该站点的用户节点数
    &quot;auth_key&quot;: &quot;pOBdl00EJ29Ad8OmVIc763k4&quot;, #（该字段已经废弃，请勿使用）
    &quot;settings&quot;:  {
        &quot;peers&quot;: 13, # 为了排序用的用户节点编号
        &quot;serving&quot;: true, # 是否帮助站点进行内容分发
        &quot;modified&quot;: 1425344149.365, # 所有站点文件的最新修改时间
        &quot;own&quot;: true, # 是否是自己的站点
        &quot;permissions&quot;: [&quot;ADMIN&quot;], # 站点权限
        &quot;size&quot;: 342165 # 站点总大小（以字节计）
    },
    &quot;bad_files&quot;: 0, # 需要下载的文件
    &quot;workers&quot;: 0, # 下载并发数
    &quot;content&quot;: { # Root content.json
        &quot;files&quot;: 12, # Number of file, detailed file info removed to reduce data transfer and parse time
        &quot;descrption&quot;: &quot;This site&quot;,
        &quot;title&quot;: &quot;ZeroHello&quot;,
        &quot;signs_required&quot;: 1,
        &quot;modified&quot;: 1425344149.365,
        &quot;ignore&quot;: &quot;(js|css)/(?!all.(js|css))&quot;,
        &quot;signers_sign&quot;: null,
        &quot;address&quot;: &quot;1EU1tbG9oC1A8jz2ouVwGZyQ5asrNsE4Vr&quot;,
        &quot;zeronet_version&quot;: &quot;0.2.5&quot;,
        &quot;includes&quot;: 0
    },
    &quot;cert_user_id&quot;: &quot;zeronetuser@zeroid.bit&quot;, # Currently selected certificate for the site
    &quot;started_task_num&quot;: 1, # Last number of files downloaded
    &quot;content_updated&quot;: 1426008289.71 # Content.json update time
}
</code></pre>

<hr />
<h4 id="sitepublish-privatekey-inner_path-sign">sitePublish <em>[privatekey], [inner_path], [sign]</em></h4>
<p>发布该站点的content.json 文件</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>privatekey</strong> （可选）</td>
<td>用于签名的私钥 (默认为当前用户的私钥)</td>
</tr>
<tr>
<td><strong>inner_path</strong> （可选）</td>
<td>想要发布的content.json的路径和名称 (默认： content.json)</td>
</tr>
<tr>
<td><strong>sign</strong> （可选）</td>
<td>假如为True，则在发布前执行对content.json的签名 (默认： True)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如执行成功，返回"ok"；否则返回error message</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 提示输入私钥
@cmd &quot;wrapperPrompt&quot;, [&quot;请输入你的私钥:&quot;, &quot;password&quot;], (privatekey) =&gt;
    $(&quot;.publishbar .button&quot;).addClass(&quot;loading&quot;)
    # 对content.json 进行签名并发布给服务端
    @cmd &quot;sitePublish&quot;, [privatekey], (res) =&gt;
        $(&quot;.publishbar .button&quot;).removeClass(&quot;loading&quot;)
        @log &quot;发布结果：&quot;, res
</code></pre>

<hr />
<h4 id="sitesign-privatekey-inner_path">siteSign <em>[privatekey], [inner_path]</em></h4>
<p>签署该站点的content.json 文件</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>privatekey</strong> （可选）</td>
<td>用于签名的私钥 (默认为当前用户的私钥)</td>
</tr>
<tr>
<td><strong>inner_path</strong> （可选）</td>
<td>想要发布的content.json的路径和名称 (默认： content.json)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如执行成功，返回"ok"；否则返回error message</p>
<blockquote>
<p><strong>提示</strong>
ZeroNet会使用"stored" 作为私钥，假如这个字段定义在users.json中 (比如克隆站点的情况)</p>
</blockquote>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">if @site_info[&quot;privatekey&quot;] # 定义在users.json中的私钥
    @cmd &quot;siteSign&quot;, [&quot;stored&quot;, &quot;content.json&quot;], (res) =&gt;
        @log &quot;Sign result&quot;, res
</code></pre>

<hr />
<h4 id="siteupdate-address">siteUpdate <em>address</em></h4>
<p>从别的用户节点那儿强行检查并下载更改过的内容（当客户端为被动模式且正在使用旧版本的ZeroNet时才有必要使用该命令）</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>想要更新的站点地址 (除非有ADMIN许可，否则只能在当前站点上执行)</td>
</tr>
</tbody>
</table>
<p><strong>Return:</strong> None</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 对于被动连接，进行手动强制更新
updateSite: =&gt;
    $(&quot;#passive_error a&quot;).addClass(&quot;loading&quot;).removeClassLater(&quot;loading&quot;, 1000)
    @log &quot;Updating site...&quot;
    @cmd &quot;siteUpdate&quot;, {&quot;address&quot;: @site_info.address}
</code></pre>

<hr />
<h1 id="plugin-cryptmessage">Plugin: CryptMessage</h1>
<h4 id="userpublickey-index">userPublickey <em>[index]</em></h4>
<p>获取用户的站点标识key</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>index</strong> （可选）</td>
<td>站点内的Sub-publickey  (默认： 0)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: base64编码过的用户标识公钥</p>
<hr />
<h4 id="eciesencrypt-text-publickey-return_aes_key">eciesEncrypt <em>text, [publickey], [return_aes_key]</em></h4>
<p>使用公钥加密一段文本</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>text</strong></td>
<td>要加密的文本</td>
</tr>
<tr>
<td><strong>publickey</strong> （可选）</td>
<td>用户的公钥 (int) 或者base64编码过的用户公钥 (默认为0)</td>
</tr>
<tr>
<td><strong>return_aes_key</strong> （可选）</td>
<td>返回加密用的AES key (默认为False)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 用base64编码的加密后的文本，或者[base64编码的加密后的文本，加密用的AES key]</p>
<hr />
<h4 id="eciesdecrypt-params-privatekey">eciesDecrypt <em>params, [privatekey]</em></h4>
<p>解密文本列表</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>params</strong></td>
<td>要加密的文本或文本列表</td>
</tr>
<tr>
<td><strong>privatekey</strong> （可选）</td>
<td>用户的私钥 (int) 或者base64编码过的用户私钥 (默认为0)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>:解码后的文本，或者解码后的文本列表（假如解码失败，返回null）</p>
<hr />
<h4 id="aesencrypt-text-key-iv">aesEncrypt <em>text, [key], [iv]</em></h4>
<p>使用key和iv来加密一段文本</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>text</strong></td>
<td>打算用 AES来加密的文本</td>
</tr>
<tr>
<td><strong>key</strong> （可选）</td>
<td>Base64编码后的密码 (默认：产生一个新的)</td>
</tr>
<tr>
<td><strong>iv</strong> （可选）</td>
<td>Base64编码后的iv (默认：产生一个新的)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: [base64 编码后的key, base64 编码后的iv, base64 编码后的加密过的文本]</p>
<hr />
<h4 id="aesdecrypt-iv-encrypted_text-key">aesDecrypt <em>iv, encrypted_text, key</em></h4>
<h4 id="aesdecrypt-encrypted_texts-keys">aesDecrypt <em>encrypted_texts, keys</em></h4>
<p>使用 IV 和 AES key来解码文本</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>iv</strong></td>
<td>Base64编码后的iv</td>
</tr>
<tr>
<td><strong>encrypted_text</strong></td>
<td>Base64编码后的加密过的文本</td>
</tr>
<tr>
<td><strong>encrypted_texts</strong></td>
<td>[Base64编码后的iv, Base64编码后的加密过的文本] 列表对</td>
</tr>
<tr>
<td><strong>key</strong></td>
<td>用于该文本的Base64编码后的密码</td>
</tr>
<tr>
<td><strong>keys</strong></td>
<td>用于解码的密码列表 (每对都尝试)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 解码后的文本，或者解码后的文本列表</p>
<hr />
<h1 id="_1">插件：消息流</h1>
<h4 id="feedfollow-feeds">feedFollow <em>feeds</em></h4>
<p>设置要处理的SQL查询</p>
<p>SQL查询语句结果会按行列返回:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>type</strong></td>
<td>类型: post, article, comment, mention</td>
</tr>
<tr>
<td><strong>date_added</strong></td>
<td>事件时间</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>事件的标题主要行</td>
</tr>
<tr>
<td><strong>body</strong></td>
<td>事件的第二、三简介行</td>
</tr>
<tr>
<td><strong>url</strong></td>
<td>通向事件页面的链接</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>feeds</strong></td>
<td>格式： {"query name": [SQL query, [param1, param2, ...], ...}, 参数 will be escaped, joined by <code>,</code> inserted in place of <code>:params</code> in the Sql query.</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: ok</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript"># 跟踪ZeroBlog的新博文
query = &quot;
    SELECT
     post_id AS event_uri,
     'post' AS type,
     date_published AS date_added,
     title AS title,
     body AS body,
     '?Post:' || post_id AS url
    FROM post
&quot;
params = [&quot;&quot;]
Page.cmd feedFollow [{&quot;Posts&quot;: [query, params]}]
</code></pre>

<hr />
<h4 id="feedlistfollow">feedListFollow</h4>
<p>返回当前的关注/跟踪的消息流</p>
<p><strong>返回值</strong>: The currently followed feeds in the same format as in the feedFollow commands</p>
<hr />
<h4 id="feedquery-limit-day_limit">feedQuery <em>[limit], [day_limit]</em></h4>
<p>执行所有堆积的SQL请求</p>
<p><strong>返回值</strong>: 所有堆积的SQL请求的结果</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>limit</strong></td>
<td>Limit of results per followed site （默认： 10）</td>
</tr>
<tr>
<td><strong>day_limit</strong></td>
<td>Return no older than number of this days （默认： 3）</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="plugin-mergersite">Plugin: MergerSite</h1>
<h4 id="mergersiteadd-addresses">mergerSiteAdd <em>addresses</em></h4>
<p>开始下载新的合并站点</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>addresses</strong></td>
<td>站点地址，或者站点地址的列表</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="mergersitedelete-address">mergerSiteDelete <em>address</em></h4>
<p>停止为合并站点做种，并且删除合并站点</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>站点地址</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="mergersitelist-query_site_info">mergerSiteList <em>[query_site_info]</em></h4>
<p>返回合并的站点</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>query_site_info</strong></td>
<td>假如为 True，则返回一个合并站点的详细信息列表</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="plugin-mute">Plugin: Mute</h1>
<h4 id="muteadd-auth_address-cert_user_id-reason">muteAdd <em>auth_address</em>, <em>cert_user_id</em>, <em>reason</em></h4>
<p>把用户添加到禁言列表中。 (对于非管理员站点，需要确认)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>auth_address</strong></td>
<td>用户数据的目录名</td>
</tr>
<tr>
<td><strong>cert_user_id</strong></td>
<td>用户的认证用户名</td>
</tr>
<tr>
<td><strong>reason</strong></td>
<td>禁言理由</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如被确认，则为ok </p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">Page.cmd(&quot;muteAdd&quot;, ['1GJUaZMjTfeETdYUhchSkDijv6LVhjekHz','helloworld@kaffie.bit','Spammer'])
</code></pre>

<hr />
<h4 id="muteremove-auth_address">muteRemove <em>auth_address</em></h4>
<p>把一个用户从禁言用户列表中移除。 (对于非管理员站点，需要确认)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>auth_address</strong></td>
<td>用户数据的目录名</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 假如被确认，则为ok</p>
<p><strong>举例：</strong></p>
<pre><code class="coffeescript">Page.cmd(&quot;muteRemove&quot;, '1GJUaZMjTfeETdYUhchSkDijv6LVhjekHz')
</code></pre>

<hr />
<h4 id="mutelist">muteList</h4>
<p>禁言用户列表 (需要站点的管理员权限)</p>
<p><strong>返回值</strong>: 禁言用户列表</p>
<hr />
<h1 id="plugin-optionalmanager">Plugin: OptionalManager</h1>
<h4 id="optionalfilelist-address-orderby-limit">optionalFileList <em>[address]</em>, <em>[orderby]</em>, <em>[limit]</em></h4>
<p>返回可选文件的列表</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>The site address you want to list optional files (default: current site)</td>
</tr>
<tr>
<td><strong>orderby</strong></td>
<td>Order of returned optional files (default: time_downloaded DESC)</td>
</tr>
<tr>
<td><strong>limit</strong></td>
<td>Max number of returned optional files (default: 10)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: Database 的可选文件记录行: file_id, site_id, inner_path, hash_id, size, peer, uploaded, is_downloaded, is_pinned, time_added, time_downlaoded, time_accessed</p>
<hr />
<h4 id="optionalfileinfo-inner_path">optionalFileInfo <em>inner_path</em></h4>
<p>从数据库中请求可选文件的信息</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>文件路径</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: Database 的可选文件记录行: file_id, site_id, inner_path, hash_id, size, peer, uploaded, is_downloaded, is_pinned, time_added, time_downlaoded, time_accessed</p>
<hr />
<h4 id="optionalfilepin-inner_path-address">optionalFilePin <em>inner_path</em>, <em>[address]</em></h4>
<p>Pin 已经下载的可选文件(不包含自动清理可选文件)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>The path of the file</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>Address for the file (default: current site)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="optionalfileunpin-inner_path-address">optionalFileUnpin <em>inner_path</em>, <em>[address]</em></h4>
<p>Remove pinning 已经下载的可选文件(包含自动清理可选文件)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>文件路径</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>文件的来源地址(默认：当前站点)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="optionalfiledelete-inner_path-address">optionalFileDelete <em>inner_path</em>, <em>[address]</em></h4>
<p>请求删除一个已经下载的可选文件</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>inner_path</strong></td>
<td>文件路径</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>文件的来源地址(默认：当前站点)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="optionallimitstats">optionalLimitStats</h4>
<p>返回目前可选文件占用的磁盘空间</p>
<p><strong>返回值</strong>: 限额大小、已使用大小和空闲大小的状态</p>
<hr />
<h4 id="actionoptionallimitset-limit">actionOptionalLimitSet <em>limit</em></h4>
<p>设置可选文件的空间限制</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>limit</strong></td>
<td>可选文件的最大大小限制（以GB计算，或已使用空间的百分比）</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="actionoptionalhelplist-address">actionOptionalHelpList <em>[address]</em></h4>
<p>可选下载文件的自动下载列表</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>你想要帮助分发的、具有可选文件的站点地址 (默认：当前站点)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: 自动下载目录的列表和描述 （字典）</p>
<hr />
<h4 id="actionoptionalhelp-directory-title-address">actionOptionalHelp directory, title, <em>[address]</em></h4>
<p>把目录添加到自动下载列表中</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>directory</strong></td>
<td>想要自动下载的目录</td>
</tr>
<tr>
<td><strong>title</strong></td>
<td>条目标题(在ZeroHello里显示)</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>所生效的站点 (默认是当前站点)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="actionoptionalhelpremove-directory-address">actionOptionalHelpRemove directory, <em>[address]</em></h4>
<p>从自动下载列表中移除掉某些目录</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>directory</strong></td>
<td>想要从自动下载列表中移除的目录</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>所生效的站点 (默认是当前站点)</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="actionoptionalhelpall-value-address">actionOptionalHelpAll value, <em>[address]</em></h4>
<p>帮助下载（和分发）所有新上传到站点的文件</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>value</strong></td>
<td>开启/关闭自动下载</td>
</tr>
<tr>
<td><strong>address</strong></td>
<td>所生效的站点 (默认是当前站点)</td>
</tr>
</tbody>
</table>
<hr />
<h1 id="admin-commands">Admin commands</h1>
<p><em>(需要data/sites.json的管理员批准)</em></p>
<hr />
<h4 id="configset-key-value">configSet <em>key, value</em></h4>
<p>修改ZeroNet的配置文件 (默认是修改zeronet.conf)</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>key</strong></td>
<td>配置条目的键名</td>
</tr>
<tr>
<td><strong>value</strong></td>
<td>配置条目的值</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: ok</p>
<hr />
<h4 id="certset-domain">certSet <em>domain</em></h4>
<p>为当前站点设置已生成的证书</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>domain</strong></td>
<td>certificate issuer的域名</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<hr />
<h4 id="channeljoinallsite-channel">channelJoinAllsite <em>channel</em></h4>
<p>请求每一个站点事件的消息通知</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>channel</strong></td>
<td>想要加入的频道 (参见channelJoin)</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<hr />
<h4 id="serverportcheck">serverPortcheck</h4>
<p>检查端口是否开放</p>
<p><strong>返回值</strong>: True (端口打开) 或者 False (端口关闭)</p>
<hr />
<h4 id="servershutdown">serverShutdown</h4>
<p>停止运行ZeroNet客户端</p>
<p><strong>返回值</strong>: None</p>
<hr />
<h4 id="serverupdate">serverUpdate</h4>
<p>从github上重新下载ZeroNet</p>
<p><strong>返回值</strong>: None</p>
<hr />
<h4 id="siteclone-address-root_inner_path">siteClone <em>address</em>, <em>[root_inner_path]</em></h4>
<p>把站点文件克隆到新的网站。</p>
<p>所有带有 <code>-default</code>后缀的文件和文件夹都会被跳过。而相对地， subfixed 版本会被拷贝。</p>
<p>例如：假如你有一个 <code>data</code> 和一个 <code>data-default</code> 目录， <code>data</code> 目录不会被拷贝，而<code>data-default</code> 目录会被考别并且重命名为<code>data</code>。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>想克隆的站点地址</td>
</tr>
<tr>
<td><strong>root_inner_path</strong></td>
<td>新站点的源目录</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None,  （完成时自动重定向到新站点）</p>
<hr />
<h4 id="sitelist">siteList</h4>
<p><strong>返回值</strong>: <list> 所有已经下载的站点的站点信息列表</p>
<hr />
<h4 id="sitepause-address">sitePause <em>address</em></h4>
<p>暂停为站点分发数据</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>打算停止为之分发数据的站点地址</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
<hr />
<h4 id="siteresume-address">siteResume <em>address</em></h4>
<p>继续为站点分发数据</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>address</strong></td>
<td>打算继续为之分发数据的站点地址</td>
</tr>
</tbody>
</table>
<p><strong>返回值</strong>: None</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../content_json/" class="btn btn-neutral float-right" title="content.json的结构"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../getting_started/" class="btn btn-neutral" title="入门"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../getting_started/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../content_json/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
